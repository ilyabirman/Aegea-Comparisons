$&&$(function(){function e(){T||(s.off("ajaxError",e),L=setInterval(a,3e3),window.addEventListener("beforeunload",a),window.addEventListener("pagehide",i),s.on("submit",t),s.on("ajaxError",e),m.on("input",n),T=!0)}function t(){clearInterval(L),i(),window.removeEventListener("pagehide",i),s.off("submit",t),m.off("input",n),T=!1}function i(){window.removeEventListener("beforeunload",a)}function n(){m[0].selectionEnd&&(C=m[0].selectionEnd)}function o(){function e(){if(!p.hasClass("chzn-done"))return void(n=setTimeout(e,500));clearTimeout(n);var t=$("#tags_chzn .search-field input");i.forEach(function(e){t.val(e+","),t.trigger({type:"keyup",which:191})})}var t=document.e2.localCopies.get(r.val(),w,x);if(t){t.caretPosition&&m.one("autosized",function(){var e=window.getCaretCoordinates(m[0],t.caretPosition),i=15;window.scrollTo(0,m.position().top+e.top-i)}),document.queryCommandSupported("insertText")?(v.focus().select(),document.execCommand("insertText",!1,t.title),v.trigger("input"),m.focus().select(),document.execCommand("insertText",!1,t.text),m.trigger("input")):(v.val(t.title).trigger("input"),m.val(t.text).trigger("input"));var i=t.tags?t.tags.slice():[];if(i.length&&p.find("option").each(function(e,t){var n=i.indexOf(t.text);n>-1&&i.splice(n,1)}),i.length)var n=setTimeout(e,500);p.val(t.tags).trigger("input"),h.empty().html(t.images.reduce(function(e,t){return e+'<div class="e2-uploaded-image"><span class="e2-uploaded-image-preview">'+t+"</span></div>"},"")),(t.alias&&f.val()!==t.alias||g.val()!==t.stamp)&&(f.val(t.alias),g.val(t.stamp),$(".e2-note-time-and-url").slideToggle()),d.show(),u.show(),t.caretPosition&&(m.focus(),m[0].selectionStart=m[0].selectionEnd=C=t.caretPosition)}}function a(){var e=d.is(":visible");if(e||b){b=e;var t=l();if(!t.images.length&&!t.title.trim()&&!t.text.trim())return void document.e2.localCopies.remove(t.id);document.e2.localCopies.save(t.id,t)}}function l(){for(var e=h.find(".e2-uploaded-image-preview"),t=r.val(),i=v.val(),n=m.val(),o=[],a=0;a<e.length;a++)o.push(e[a].innerHTML);return{id:t,title:i,text:n,tags:p.val(),images:o,alias:"new"!=E&&f.val(),stamp:g.val(),timestamp:(new Date).getTime(),link:location.pathname,isPublished:c.val(),caretPosition:C}}if(document.e2.isLocalStorageAvailable){var s=$("#form-note"),r=$("#note-id"),c=$("#is-note-published"),d=$("#livesave-button"),u=$("#livesave-button + .e2-unsaved-led"),v=$("#title"),m=$("#text"),p=$("#tags"),f=$("#alias"),g=$("#stamp"),h=$("#e2-uploaded-images"),w=1e3*+$("#note-timestamp").val(),x=1e3*+$("#server-time").val(),C=null,b=d.is(":visible"),E=$("#note-id").val(),T=!1,L=null;document.e2.localCopies.loadLocalCopy=o,document.e2.localCopies.initLocalSaver=e,document.e2.localCopies.destroyLocalSaver=t}});