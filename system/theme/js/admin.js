$&&$(function(){!function(e){function t(r){if(n[r])return n[r].exports;var a=n[r]={i:r,l:!1,exports:{}};return e[r].call(a.exports,a,a.exports,t),a.l=!0,a.exports}var n={};t.m=e,t.c=n,t.d=function(e,n,r){t.o(e,n)||Object.defineProperty(e,n,{configurable:!1,enumerable:!0,get:r})},t.n=function(e){var n=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(n,"a",n),n},t.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},t.p="",t(t.s=9)}([function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default={mac:/Macintosh/.test(navigator.userAgent),iosdevice:/(iPad)|(iPhone)/.test(navigator.userAgent)}},function(e,t,n){"use strict";function r(e,t,n){var r=void 0,a={event:"keydown",target:document,prevent:!1};n=u(n,a),Array.isArray(e)?(r=[],c.default.mac||(e=e.map(function(e){return e.replace("Cmd","Ctrl")})),e.forEach(function(e){return r.push(o(e,t,n))})):(c.default.mac||(e=e.replace("Cmd","Ctrl")),r=o(e,t,n));var i="string"==typeof n.target?document.querySelector(n.target):n.target;Array.isArray(r)?r.forEach(function(r,a){f[e[a]]||(f[e[a]]=[]),i.addEventListener(n.event,r,!1),f[e[a]].push({event:n.event,elem:i,fn:t,realFn:r})}):(f[e]||(f[e]=[]),i.addEventListener(n.event,r,!1),f[e].push({event:n.event,elem:i,fn:t,realFn:r}))}function a(e,t,n){function r(e){f[e]&&f[e].slice().reverse().forEach(function(e,r,a){e.fn!==t||n.target&&e.elem!==n.target||(e.elem.removeEventListener(e.event,e.realFn,!1),a.splice(a.length-1-r,1))})}n=n||{},Array.isArray(e)?e.forEach(r):r(e)}function o(e,t,n){return e=l(e).split("+"),function(r){i(r,e)&&(t(r),n.prevent&&(r.preventDefault(),r.stopPropagation()))}}function i(e,t){var n=s(e.keyCode),r={enter:13},a={},o=["shift","ctrl","alt","cmd"],i=0;o.forEach(function(e){a[e]={wanted:!1,pressed:!1}}),e.shiftKey&&(a.shift.pressed=!0),e.ctrlKey&&(a.ctrl.pressed=!0),e.altKey&&(a.alt.pressed=!0),e.metaKey&&(a.cmd.pressed=!0);for(var l=0;l<t.length;l++){var u=t[l];o.indexOf(u)>-1?(i++,a[u].wanted=!0):(u.length>1&&r[u]===e.keyCode||n===u)&&i++}return t.length===i&&Object.keys(a).reduce(function(e,t){return e&&a[t].wanted===a[t].pressed},!0)}function s(e){switch(e){case 91:case 93:return"MetaKey";case 188:return",";case 190:return".";case 219:return"[";case 221:return"]";default:return String.fromCharCode(e).toLowerCase()}}function l(e){return e.toLowerCase().replace(/\s/g,"")}function u(e,t){if(e){for(var n in t)void 0===e[n]&&(e[n]=t[n]);return e}return t}Object.defineProperty(t,"__esModule",{value:!0}),t.unbindKeys=t.bindKeys=void 0;var d=n(0),c=function(e){return e&&e.__esModule?e:{default:e}}(d),f={};t.bindKeys=r,t.unbindKeys=a},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var a=n(3);Object.defineProperty(t,"default",{enumerable:!0,get:function(){return r(a).default}})},function(e,t,n){"use strict";function r(e){y.forEach(function(t){function n(){function t(){function a(){e.selectionStart=n,e.selectionEnd=r,o.removeChild(i)}var o=document.head||document.getElementsByTagName("head")[0],i=document.createElement("style");i.type="text/css",i.appendChild(document.createTextNode("::selection { background: transparent; }")),o.appendChild(i),setTimeout(a,10),(0,w.unbindKeys)(l,t,{target:e})}var n=e.selectionStart,r=e.selectionEnd,l=["Cmd+Z","Ctrl+Z"];"inline"===a&&-1!==e.value.substring(n,r).indexOf("\n")||(o(e,n,r)?i(e,n,r):s(e,n,r),(0,w.bindKeys)(l,t,{target:e}),$(e).on("input",function(){(0,w.unbindKeys)(l,t,{target:e})}))}var r=t.keys,a=(t.name,t.type),o=t.isWrapped,i=t.unwrap,s=t.wrap;(0,w.bindKeys)(r,n,{target:e,prevent:!0})})}function a(e,t){document.execCommand("insertText",!1,t),$(e).trigger("input")}function o(e,t,n){var r=e.value,a=t,o=n;if(a===o||void 0===o){for(a-=1,o=a;a>0&&!/\s/.test(r[a]);)a--;for(a<=0?a=0:a++;o<r.length&&!/\s/.test(r[o]);)o++;o>=r.length?o=r.length-1:o--}else o--;return{value:r.substring(a,o+1),start:a,end:o}}function i(e,t,n){var r=e.value,a=["[","("],o=["]",")"];return t!==n&&(n-=1,a.indexOf(r[t])>-1&&a.indexOf(r[t+1])>-1&&o.indexOf(r[n])>-1&&o.indexOf(r[n-1])>-1)}function s(e,t,n){var r=o(e,t,n),i=e.value,s=2,l=i;t=r.start,n=r.end+1,x.test(r.value)?(l="(("+i.substring(t,n)+" ))",s+=n+1):0===r.value.length||" "===r.value?(l="(( ))",s+=t):(l="(( "+i.substring(t,n)+"))",s+=t),e.selectionStart=t,e.selectionEnd=n,a(e,l),e.selectionStart=s,e.selectionEnd=s}function l(e,t,n){var r=o(e,t,n),a=r.value.substr(2).split(" ");t=r.start+2,a.length>1&&x.test(a[0])?(e.selectionStart=t,e.selectionEnd=t+a[0].length):(e.selectionStart=t,e.selectionEnd=t)}function u(e,t,n,r){var a=t.value,o=e,i=e;Array.isArray(e)&&(o=e[0],i=e[1]);var s=o+o,l=i+i;if(n!==r){var u=p(e,t,n,r);return a.substr(u.start-2,2)===s&&a.substr(u.end,2)===l}return f(e,t,n).wrapped}function d(e,t,n,r){var o=t.value,i=void 0;n===r?(i=f(e,t,n),n=i.wordStart,r=i.wordStart===i.wordEnd?i.wordEnd:i.wordEnd+1):(i=p(e,t,n,r),n=i.start,r=i.end),t.selectionStart=n,t.selectionEnd=r,a(t,function(e,t,n,r){var a=e+e;return a+t.substring(n,r)+a}(e,o,n,r)),t.selectionStart=n+2,t.selectionEnd=r+2}function c(e,t,n,r){var o=t.value,i=void 0;n===r?(i=f(e,t,n),n=i.start+2,r=i.end-1):(i=p(e,t,n,r),n=i.start,r=i.end),t.selectionStart=n-2,t.selectionEnd=r+2,a(t,function(e,t,n){return e.substring(t,n)}(o,n,r)),t.selectionStart=n-2,t.selectionEnd=r-2}function f(e,t,n){var r=t.value,a=e,o=e,i=null,s=null,l=null,u=null,d=n-1,c=n,f=0;if(Array.isArray(e)&&(a=e[0],o=e[1]),/\s/.test(r[d])&&(c===r.length||/\s/.test(r[c])))return{start:i,end:s,wordStart:c,wordEnd:c,wrapped:!1};for(;!i&&d>=0;){if(/\s/.test(r[d])){l=d+1;break}r[d]===a&&f++,2===f&&(i=d),d--}for(l||0!==d||(l=d),l||null===i||(l=i+2),f=0;!s&&c<r.length;){if(/\s/.test(r[c])){u=c-1;break}r[c]===o&&f++,2===f&&(s=c),c++}return u||c!==r.length||(u=r.length-1),u||null===s||(u=s-2),{start:i,end:s,wordStart:l<=u?l:u,wordEnd:u>=l?u:l,wrapped:null!==i&&null!==s}}function p(e,t,n,r){var a=t.value,o=e,i=e;for(Array.isArray(e)&&(o=e[0],i=e[1]);a[r-1]===o&&n<=r-1;)r--;for(;a[n]===i&&n<=r;)n++;return{start:n,end:r}}function v(e,t,n,r){var a=t.value;for(n-=1;"\n"!==a[n]&&n>0;)n--;for(0!==n&&n++;"\n"!==a[r]&&r<a.length;)r++;return{start:n,end:r}}function m(e,t,n,r){function a(e){var a=t.value,o=v(e,t,n,r);return a.substring(o.start,o.end).split("\n").reduce(function(t,n){return t||0===n.indexOf(e)&&!Object.keys(C).reduce(function(t,r){return t||r!==e&&C[r].test(n)},!1)},!1)}return Array.isArray(e)?e.reduce(function(e,t){return e||a(t)},!1):"string"==typeof e&&a(e)}function g(e,t,n,r,o){var i=t.value,s=e+" ",l=v(e,t,n,r),u=0;o=o||{},t.selectionStart=l.start,t.selectionEnd=l.end,a(t,function(t,n,r){var a=t.substring(n,r).split("\n");return a=a.map(function(t){return o.skipChecking||Object.keys(C).forEach(function(n){if(n!==e){var r=t.match(C[n]);r&&(u-=r[1].length,t=t.replace(r[1],""))}}),0===t.indexOf(e)?(u+=e.length,e+t):(u+=s.length,s+t)}),a.join("\n")}(i,l.start,l.end)),t.selectionStart=l.start,t.selectionEnd=l.end+u}function h(e,t,n,r){g(e,t,n,r,{skipChecking:!0})}function b(e,t,n,r){var o=t.value,i=e+" ",s=v(e,t,n,r),l=0;t.selectionStart=s.start,t.selectionEnd=s.end,a(t,function(t,n,r){var a=t.substring(n,r).split("\n"),o=null;return a=a.map(function(t){return e instanceof RegExp&&(o=t.match(e))?(t=t.replace(o[0],""),l-=o[0].length):0===t.trim().indexOf(i)?(t=t.replace(i,""),l-=i.length):t.indexOf(e)>-1&&(t=t.replace(e,""),l-=e.length),t}),a.join("\n")}(o,s.start,s.end)),t.selectionStart=s.start,t.selectionEnd=s.end+l}Object.defineProperty(t,"__esModule",{value:!0});var w=n(1),y=[{name:"bold",type:"inline",keys:"Cmd+B",isWrapped:u.bind(null,"*"),wrap:d.bind(null,"*"),unwrap:c.bind(null,"*")},{name:"italic",type:"inline",keys:"Cmd+I",isWrapped:u.bind(null,"/"),wrap:d.bind(null,"/"),unwrap:c.bind(null,"/")},{name:"link",type:"inline",keys:"Cmd+K",isWrapped:i,wrap:s,unwrap:l},{name:"header",type:"block",keys:"Cmd+Alt+1",isWrapped:m.bind(null,"#"),wrap:g.bind(null,"#"),unwrap:b.bind(null,"#")},{name:"subheader",type:"block",keys:"Cmd+Alt+2",isWrapped:m.bind(null,"##"),wrap:g.bind(null,"##"),unwrap:b.bind(null,"##")},{name:"remove headers",type:"block",keys:"Cmd+Alt+0",isWrapped:m.bind(null,["#","##"]),wrap:function(){},unwrap:b.bind(null,/^##\s?|^#\s?/)},{name:"increase quote level",type:"block",keys:"Cmd+]",isWrapped:m.bind(null,">"),wrap:h.bind(null,">"),unwrap:h.bind(null,">")},{name:"decrease quote level",type:"block",keys:"Cmd+[",isWrapped:m.bind(null,">"),wrap:b.bind(null,">"),unwrap:b.bind(null,">")}],C={"#":/(^\s*#\s*)([^#]+)/,"##":/(^\s*##\s*)/,">":/^(\s*>\s*)/},x=/((([A-Za-z]{3,9}:(?:\/\/)?)(?:[-;:&=+$,\w]+@)?[A-Za-z0-9.-]+|(?:www.|[-;:&=+$,\w]+@)[A-Za-z0-9.-]+)((?:\/[+~%\/.\w-_]*)?\??(?:[-+=&;%@.\w_]*)#?(?:[.!\/\\\w]*))?)/;t.default=r},,,,,,function(e,t,n){"use strict";function r(e){var t=e.file,n=e.url,r=e.progressCallback,a=e.doneCallback,o=e.errorCallback;if(window.FormData){var i=new window.FormData;i.append("file",t),$.ajax({type:"POST",timeout:0,url:n,data:i,cache:!1,contentType:!1,processData:!1,xhr:function(){var e=$.ajaxSettings.xhr();return e.upload&&e.upload.addEventListener("progress",r,!1),e},success:a,error:o})}}function a(e,t,n){return e.removeClass("e2-toggle-on"),e.addClass("e2-toggle-thinking"),$.ajax({type:"post",timeout:1e4,url:e.attr("href"),data:"result=ajaxresult",success:function(r){"on-rehref|"===r.substr(0,10)&&(e.addClass("e2-toggle-on"),t(r.substr(10))),"off-rehref|"===r.substr(0,11)&&(e.removeClass("e2-toggle-on"),n(r.substr(11)))},error:function(){window.location.href=e.attr("href")},complete:function(){e.removeClass("e2-toggle-thinking")}}),!1}function o(e){var t=e.originalEvent.dataTransfer;if(t&&(!t.types.contains||t.types.contains("Files"))&&(!t.types.indexOf||-1!==t.types.indexOf("Files"))){t.dropEffect&&(t.dropEffect="copy");var n=$(this);return n.addClass("e2-external-drop-target-dragover"),n.hasClass("e2-external-drop-target-altable")&&e.altKey?n.addClass("e2-external-drop-target-dragover-alt"):n.removeClass("e2-external-drop-target-dragover-alt"),!1}}function i(){var e=$(this);return e.removeClass("e2-external-drop-target-dragover"),e.removeClass("e2-external-drop-target-dragover-alt"),!1}function s(e,t){var n=.1+.8*Math.min(t,1);e.style.strokeDashoffset=Math.floor(245-245*n)}function l(e){var t=$(this),n=t.find("img"),a=e.originalEvent.dataTransfer;if(a||a.files){if(1===a.files.length){var o=a.files[0],i=$("#e2-user-picture-uploading #e2-progress")[0],l="e2-user-picture-container-uploading";t.addClass(l),r({file:o,url:$("#e2-userpic-upload-action").attr("href"),progressCallback:function(e){s(i,e.loaded/e.total)},doneCallback:function(e){if(s(i,0),"image|"===e.substr(0,6)){var r=e.substr(6).split("|")[0];n.attr("src",r+"?"+encodeURIComponent(new Date)),n.bind("load",function(){return t.removeClass(l)}),$(".e2-set-userpic-by-dragging").slideUp(333)}else t.removeClass(l)},errorCallback:function(){s(i,0)}})}return!1}}n(10),n(11),n(12),n(13),n(14),n(15),n(16),$(".e2-favourite-toggle").click(function(){var e=$(this),t=function(t){return function(n){e.attr("href",n).closest(".e2-note")[t]("e2-note-favourite")}};return a(e,t("addClass"),t("removeClass"))}),$(".e2-pinned-toggle").click(function(){var e=$(this),t=function(t){return e.attr("href",t)};return a(e,t,t)}),$(".e2-important-toggle").click(function(){var e=$(this),t=function(t){return function(n){e.attr("href",n).closest(".e2-comment-meta-area")[t]("important").find(".e2-comment-piece-markable")[t]("e2-comment-piece-marked")}};return a(e,t("addClass"),t("removeClass"))}),$(".e2-removed-toggle").click(function(){var e=$(this),t=e.closest(".e2-comment");return t.find(".e2-comment-actions, .e2-comment-actions-removed").addClass("e2-comment-actions-disabled"),a(e,function(e){t.find(".e2-comment-actions").removeClass("e2-comment-actions-disabled").end().find(".e2-comment-actions-removed").hide().end().find(".e2-comment-content, .e2-comment-meta").slideDown(333).end().find(".e2-comment-author").removeClass("e2-comment-author-removed").end().find(".e2-removed-toggle").attr("href",e),t.is(".e2-reply")||t.siblings(".e2-reply").slideDown(333)},function(e){t.find(".e2-comment-actions-removed").removeClass("e2-comment-actions-disabled").end().find(".e2-comment-author").addClass("e2-comment-author-removed").end().find(".e2-comment-meta, .e2-comment-content").slideUp(333,function(){return t.find(".e2-comment-actions-removed").show()}).end().find(".e2-removed-toggle").attr("href",e),t.is(".e2-reply")||t.siblings(".e2-reply").slideUp(333)})}),$(".e2-external-drop-target").bind("dragover dragenter",o).bind("dragleave drop",i),$(".e2-user-picture-container").bind("drop",l),function(){if(document.e2.isLocalStorageAvailable){var e=$("#e2-drafts-item"),t=e.find(".e2-unsaved-led"),n=$("#e2-new-note-item .e2-unsaved-led"),r=$("#e2-notes-unsaved"),a=$("#e2-nothing-message"),o=$("#form-note"),i=document.e2.localCopies.getList(),s=document.e2.localCopies.doesCopyExist("new"),l=o?$("#note-id").val():null,u="new"!==l&&document.e2.localCopies.doesCopyExist(l),d=Object.keys(i).length;if(s&&d--,u&&d--,t&&d>0&&(e.show(),t.show()),n&&s&&n.show(),r&&a){var c=document.e2.localCopies.getName("new");i.hasOwnProperty(c)&&delete i[c];for(var f in i)"false"===i[f].isPublished&&($("#e2-draft-"+f+" .e2-unsaved-led").show(),delete i[f]);if(Object.keys(i).length){for(var p in i){var v=document.e2.localCopies.get(p);if(v){var m=$("#e2-unsaved-note-prototype").clone(!0);m.attr("id",null),$(".e2-admin-link",m).attr("href",v.link),$("u",m).html(v.title),m.attr("style",""),r.append(m)}}r.show(),a.hide()}}}}()},function(e,t,n){"use strict";document.e2=document.e2||{};var r=window.localStorage;document.e2.isLocalStorageAvailable=function(){try{return r.setItem("test","test"),r.removeItem("test"),!0}catch(e){return!1}}(),document.e2.isLocalStorageAvailable&&(document.e2.localCopies={_lsKey:"copies-info",_lsPrefix:"copy-",_cookieName:document.e2.cookiePrefix+"local_copies",getListName:function(){return this._lsKey},getPrefix:function(){return this._lsPrefix},getName:function(e){return this._lsPrefix+e},save:function(e,t){r.setItem(this.getName(e),JSON.stringify(t)),this.addToList(e,t)},remove:function(e){r.removeItem(this.getName(e)),this.removeFromList(e)},get:function(e,t,n){var a=!1;try{if(!(a=JSON.parse(r.getItem(this.getName(e)))))return!1}catch(e){return!1}return n&&t&&this.isCopyOutdated(a,t,n)?(this.remove(e),!1):a},getList:function(){try{return JSON.parse(r.getItem(this._lsKey))||{}}catch(e){return{}}},addToList:function(e,t){var n=this.getList();n.hasOwnProperty(e)||(n[e]={isPublished:t.isPublished,timestamp:t.timestamp},r.setItem(this._lsKey,JSON.stringify(n)),this.updateCookie(n))},removeFromList:function(e){var t=this.getList();t.hasOwnProperty(e)&&(delete t[e],r.setItem(this._lsKey,JSON.stringify(t)),this.updateCookie(t))},doesCopyExist:function(e){return r.hasOwnProperty(this.getName(e))},isCopyOutdated:function(e,t,n){if(!t||!n)return!1;var r=+e.timestamp,a=(new Date).getTime(),o=n-a;return Math.abs(o)>216e6&&(t-=o),r<=t},checkOutdatedCopies:function(){var e=document.e2.noteLastModifiedsById||{},t=this.getList();for(var n in t)"new"!==n&&(e.hasOwnProperty(n)?this.isCopyOutdated(t[n],1e3*e[n],1e3*document.e2.serverTime)&&this.remove(n):this.remove(n))},generateCookie:function(){document.cookie.match(new RegExp("(?:^|; )"+this._cookieName.replace(/([.$?*|{}()[]\\\/\+^])/g,"\\$1")+"=([^;]*)"))||this.updateCookie()},updateCookie:function(e){e=e||this.getList();var t=[];for(var n in e)"new"!==n&&t.push(n);if(t.length)document.cookie=this._cookieName+"="+t.join(",")+";path=/";else{var r=new Date;r.setTime(r.getTime()-1),document.cookie=this._cookieName+'="";path=/;expires='+r.toUTCString()}}},document.e2.localCopies.checkOutdatedCopies(),document.e2.localCopies.generateCookie())},function(e,t,n){"use strict";$(function(){function e(){k||(s.off("ajaxError",e),E=setInterval(o,3e3),window.addEventListener("beforeunload",o),window.addEventListener("pagehide",n),s.on("submit",t).on("ajaxError",e),p.on("input",r),k=!0)}function t(){clearInterval(E),n(),window.removeEventListener("pagehide",n),s.off("submit",t),p.off("input",r),k=!1}function n(){window.removeEventListener("beforeunload",o)}function r(){p[0].selectionEnd&&(x=p[0].selectionEnd)}function a(){var e=document.e2.localCopies.get(l.val(),b,w);if(e){e.caretPosition&&p.one("autosized",function(){var t=window.getCaretCoordinates(p[0],e.caretPosition);window.scrollTo(0,p.position().top+t.top-15)}),document.queryCommandSupported("insertText")?(f.focus().select(),document.execCommand("insertText",!1,e.title),f.trigger("input"),p.focus().select(),document.execCommand("insertText",!1,e.text),p.trigger("input")):(f.val(e.title).trigger("input"),p.val(e.text).trigger("input"));var t=e.tags?e.tags.slice():[];if(t.length&&v.find("option").each(function(e,n){var r=t.indexOf(n.text);r>-1&&t.splice(r,1)}),t.length){var n=void 0,r=function e(){if(!v.hasClass("chzn-done"))return void(n=setTimeout(e,500));clearTimeout(n);var r=$("#tags_chzn .search-field input");t.forEach(function(e){r.val(e+","),r.trigger({type:"keyup",which:191})})};n=setTimeout(r,500)}v.val(e.tags).trigger("input"),h.empty().html(e.images.reduce(function(e,t){return e+'<div class="e2-uploaded-image"><span class="e2-uploaded-image-preview">'+t+"</span></div>"},"")),(e.alias&&m.val()!==e.alias||g.val()!==e.stamp)&&(m.val(e.alias),g.val(e.stamp),$(".e2-note-time-and-url").slideToggle()),d.show(),c.show(),e.caretPosition&&(p.focus(),p[0].selectionStart=p[0].selectionEnd=x=e.caretPosition)}}function o(){var e=d.is(":visible");if(e||C){C=e;var t=i();if(!t.images.length&&!t.title.trim()&&!t.text.trim())return void document.e2.localCopies.remove(t.id);document.e2.localCopies.save(t.id,t)}}function i(){for(var e=h.find(".e2-uploaded-image-preview"),t=l.val(),n=f.val(),r=p.val(),a=[],o=0;o<e.length;o++)a.push(e[o].innerHTML);return{id:t,title:n,text:r,tags:v.val(),images:a,alias:"new"!==y&&m.val(),stamp:g.val(),timestamp:(new Date).getTime(),link:window.location.pathname,isPublished:u.val(),caretPosition:x}}var s=$("#form-note");if(document.e2.isLocalStorageAvailable&&s){var l=$("#note-id"),u=$("#is-note-published"),d=$("#livesave-button"),c=$("#livesave-button + .e2-unsaved-led"),f=$("#title"),p=$("#text"),v=$("#tags"),m=$("#alias"),g=$("#stamp"),h=$("#e2-uploaded-images"),b=1e3*+$("#note-timestamp").val(),w=1e3*+$("#server-time").val(),y=l.val(),C=d.is(":visible"),x=null,k=!1,E=null;document.e2.localCopies.loadLocalCopy=a,document.e2.localCopies.initLocalSaver=e,document.e2.localCopies.destroyLocalSaver=t}})},function(e,t,n){"use strict";var r=$(".e2-note");r.length&&document.e2.isLocalStorageAvailable&&function(e){for(var t=0;t<e.length;t++){var n=e[t].id.replace("e2-note-","");document.e2.localCopies.doesCopyExist(n)&&$("#e2-note-"+n+" .e2-unsaved-led").show()}}(r)},function(e,t,n){"use strict";var r=n(1),a=n(0),o=function(e){return e&&e.__esModule?e:{default:e}}(a);$(function(){function e(e){e=e||{},$.ajax({data:$("form").serialize(),url:$("#e2-note-livesave-action").attr("href"),success:function(t){e.onAjaxSuccess&&e.onAjaxSuccess();var n;try{n=JSON.parse(t)}catch(t){return void(e.onError&&e.onError(t.message))}if("created"===n.status){var r=n.id;window.history.replaceState&&(window.history.replaceState(null,"",n["note-edit-url"]),$(".e2-admin-menu-new-selected").hide(),$(".e2-admin-menu-new").show()),$("#note-id").val(r),i(),e.onCreated&&e.onCreated(n),u=null}else"saved"===n.status?($("#alias").val(n["new-alias"]),window.history.replaceState&&window.history.replaceState(null,"",n["note-edit-url"]),i(),e.onSaved&&e.onSaved(n),u=null):"error"===n.status&&e.onError&&e.onError(n.message)},error:function(t){e.onAjaxError&&e.onAjaxError(t.responseText)},complete:function(t){e.onAjaxComplete&&e.onAjaxComplete()}})}function t(){$("#stamp").val()&&m.test($("#stamp").val()),/^ *$/.test($("#title").val())||/^ *$/.test($("#text").val())||v?$("#submit-button").attr("disabled","disabled"):$("#submit-button").removeAttr("disabled")}function n(e){$("#e2-console").html(e),$("#livesaving").hide(),$("#livesave-button, #livesave-button + .e2-unsaved-led").show(),$("#livesave-error").show(),$("#livesave-error").attr("title",e)}function a(){if(!v){var r=s();if(""!==r.text){if(v=!0,t(),""===r.title){var a,o=r.text;(a=o.indexOf("."))>=0&&(o=o.substr(0,a)),(a=o.indexOf(";"))>=0&&(o=o.substr(0,a)),(a=o.indexOf(","))>=0&&(o=o.substr(0,a)),(a=o.indexOf(")"))>=0&&(o=o.substr(0,a)),0===o.indexOf("((")&&(o=o.substr(2)),o=o.substr(0,1).toUpperCase()+o.substr(1),$("#title").val(o).change()}$("#livesave-button, #livesave-button + .e2-unsaved-led, #livesave-error").hide(),$("#livesaving").fadeIn(333),e({onCreated:function(){d=r,$("#e2-drafts")&&$("#e2-drafts-item")&&($("#e2-drafts-item").fadeIn(333),$('<div class="e2-admin-menu-item-frame"></div>').css({position:"absolute",left:$("#e2-note-form-wrapper").offset().left,top:$("#e2-note-form-wrapper").offset().top,width:$("#e2-note-form-wrapper").width(),height:$("#e2-note-form-wrapper").height()}).appendTo("body").animate({left:$("#e2-drafts").offset().left-10,top:$("#e2-drafts").offset().top-5,width:$("#e2-drafts").width()+20,height:$("#e2-drafts").height()+10},667).fadeTo(333,.667).fadeOut(333),$("#e2-drafts-count").html(1*$("#e2-drafts-count").html()+1))},onSaved:function(){d=r},onError:n,onAjaxSuccess:function(){$("#livesaving").fadeOut(333)},onAjaxError:n,onAjaxComplete:function(){v=!1,t()}})}}}function i(){document.e2.isLocalStorageAvailable&&(u?document.e2.localCopies.remove(u):document.e2.localCopies.remove($("#note-id").val()),document.e2.localCopies.destroyLocalSaver())}function s(){return{title:$("#title").val(),tags:($("#tags").val()||[]).join(),text:$("#text").val(),alias:$("#alias").val(),stamp:$("#stamp").val()}}function l(e,t){return JSON.stringify(e)===JSON.stringify(t)}if($("#form-note").length){var u=$("#note-id").val(),d=s(),c=d?Object.assign({},d):s(),f=!1,p=!1,v=!1,m=/^ *(\d{1,2})\.(\d{1,2})\.(\d{2}|\d{4}) +(\d{1,2}):(\d{1,2}):(\d{1,2}) *$/;$(window).bind("pageshow",function(e){e.originalEvent.persisted&&window.location.reload()}),document.e2.localCopies.initLocalSaver&&document.e2.localCopies.loadLocalCopy&&(document.e2.localCopies.loadLocalCopy(),document.e2.localCopies.initLocalSaver()),$.ajaxSetup({type:"post",timeout:1e4}),$("#form-note").on("submit",function(n){function r(e){d=o,$("#note-saving").hide(),$("#note-saved").fadeIn(333),window.location.href=e["note-url"]}function a(e){$("#form-note").trigger("ajaxError"),$("#note-saving").hide(),$("#submit-keyboard-shortcut").show(),$("#note-save-error").show(),$("#note-save-error").attr("title",e)}n.preventDefault();var o=s();v=!0,t(),$("#submit-keyboard-shortcut, #note-save-error").hide(),$("#note-saving").show(),e({onCreated:r,onSaved:r,onError:a,onAjaxError:a,onAjaxComplete:function(){v=!1,t()}})}),$("#title").bind("input",function(){$("#alias").attr("placeholder","")});var g="change input keyup keydown keypress mouseup mousedown cut copy paste blur",h=function(){$("#stamp").val()&&$("#stamp").toggleClass("input-error",null===$("#stamp").val().match(m)),t();var e=s();f=!l(c,e),p=!d||!l(d,e);var n=$("#livesave-button, #livesave-button + .e2-unsaved-led");f&&p&&""!==e.text?(f=!1,$("#livesaving").hide(),document.e2.localCopies.initLocalSaver(),n.fadeIn(333),c=Object.assign({},e)):p||(p=!1,i(),n.fadeOut(333),c=Object.assign({},e));var r=e.title.trim(),a=e.text.trim();$("#e2-uploaded-images .e2-uploaded-image-preview").length||r||a||!n.is(":visible")||n.fadeOut(333)};$("#title").add("#tags").add("#text").add("#alias").add("#stamp").bind(g,h),$("#tags").on("liszt:ready",function(){$("#tags_chzn .search-field").bind(g,h)}),$("#title").bind("keydown",function(e){13===e.keyCode&&$("#text").focus()}),$("#livesave-button").click(function(){return a(),!1}),o.default.mac?(0,r.bindKeys)("Cmd+S",a,{prevent:!0}):(0,r.bindKeys)("Ctrl+S",a,{prevent:!0}),$("#text").is(":focus")||$("#title").attr("autofocus",!0).focus().val($("#title").val()),t()}})},function(e,t,n){"use strict";$(function(){function e(e,t,n,r,a){if(window.FormData){var o=new window.FormData;o.append("file",e),$.ajax({type:"POST",timeout:0,url:t,data:o,cache:!1,contentType:!1,processData:!1,xhr:function(){var e=$.ajaxSettings.xhr();return e.upload&&e.upload.addEventListener("progress",n,!1),e},success:r,error:a})}}function t(e){var t="";if("calliope"===$("#formatter-id").val()&&(t="(("+e+"))"),"neasden"===$("#formatter-id").val()&&(t=e+""),t){var n=document.getElementById("text");if(n.focus(),n.selectionStart||"0"===n.selectionStart){var r=n.selectionStart,a=n.selectionEnd,o=t;if(r===a){for(;"\r"!==n.value.charAt(r)&&"\n"!==n.value.charAt(r)&&r>0;)r-=1;for(;"\r"===n.value.charAt(r)||"\n"===n.value.charAt(r);)r+=1;o+="\n\n",a=r}n.value=n.value.substring(0,r)+o+n.value.substring(a,n.value.length),n.selectionStart=n.selectionEnd=r+o.length-2}else n.value+="\r\n\r\n"+t;if("createEvent"in document){var i=document.createEvent("HTMLEvents");i.initEvent("change",!1,!0),n.dispatchEvent(i)}else n.fireEvent("onchange");n.focus()}}function n(e,t,n,r){var a=$("#e2-uploaded-image-prototype").clone(!0);return a.attr("style",""),a.css("width",""),a.find(".e2-uploaded-image-preview img").attr("src",e+"?"+(new Date).getTime()).attr("alt",t).attr("width",n).attr("height",r),a.find(".e2-uploaded-image-remover").data("file",t),d.push(t),a}function r(e,t){var n=$("#e2-file-remove-action").attr("href")+"?";$("#form-note")?n+="entity=note&entity-id="+$("#note-id").val():$("#form-tag")?n+="entity=tag&entity-id="+$("#tag-id").val():n=null,$.ajax({data:e,timeout:6e4,url:n,success:function(n){"error|"===n.substr(0,6)?t.fadeTo(333,1):(d.splice($.inArray(e.file,d),1),t.hide(333,function(){$(this).remove()}))},error:function(e){t.fadeTo(333,1)}})}function a(e){var t="",n=e.lastIndexOf(".");return-1!==n&&(t=e.substr(n+1)),$(".e2-upload-error").slideUp(333),/^gif|jpe?g|png|svg|mp3$/i.test(t)?($("#e2-uploading").show().css("opacity",1),$("#e2-upload-button").hide(),!0):($("#e2-upload-error-unsupported-file").slideDown(333),!1)}function o(e,r,a){if(r=JSON.parse(r),r.success)if(c+=e.size,r.overwrite){$("#e2-uploading").hide(),$("#e2-upload-button").show();var o=$('#e2-uploaded-images img[src="'+r.thumb+'"], #e2-uploaded-images img[src^="'+r.thumb+'?"]')[0];o&&(o.src=r.thumb+"?"+(new Date).getTime())}else{a&&t(r["new-name"]);var i=-1!==$.inArray(r["new-name"],d);i?($("#e2-uploading").hide(),$("#e2-upload-button").show()):n(r.thumb,r["new-name"],r.width,r.height).appendTo($("#e2-uploaded-images")).show(333,function(){$("#e2-uploading").hide(),$("#e2-upload-button").show()})}else $("#e2-uploading").hide(),$("#e2-upload-button").show(),"could-not-create-thumbnail"===r.error?$("#e2-upload-error-cannot-create-thumbnail").slideDown(333):$("#e2-upload-error-cannot-upload").slideDown(333);s()}function i(e,t){t=Math.min(t,1);var n=.1+.8*t,r=Math.floor(245-245*n);e.style.strokeDashoffset=r}function s(){if(u.length){var t=u.shift(),n=t.name,r=$("#e2-file-upload-action").attr("href")+"?";return $("#form-note")?r+="entity=note&entity-id="+$("#note-id").val():$("#form-tag")?r+="entity=tag&entity-id="+$("#tag-id").val():r=null,r&&t.e2AltKeyPressed&&(r+="&overwrite"),a(n)&&e(t,r,function(e){i($("#e2-uploading #e2-progress")[0],(c+e.loaded)/f)},function(e,n,r){i($("#e2-uploading #e2-progress")[0],0),o(t,e,t.e2DroppedIntoTextarea)},function(e,n,r){i($("#e2-uploading #e2-progress")[0],0),o(null,'{"success": false}',t.e2DroppedIntoTextarea)}),!1}return f=0,c=0,!0}function l(e){var t=e.originalEvent.dataTransfer;if(t&&t.files){for(var n=0;n<t.files.length;n++)t.files[n].e2AltKeyPressed=e.altKey,t.files[n].e2DroppedIntoTextarea=e.target===document.getElementById("text"),u.push(t.files[n]),c=0,f+=t.files[n].size;return s(),!1}}if($("#form-tag").length||$("#form-note").length){var u=[],d=[],c=0,f=0;$("#e2-uploaded-image-prototype").click(function(){t($(this).find(".e2-uploaded-image-preview img").attr("alt"))}),$(".e2-uploaded-image-remover").click(function(){var e=$(this).parent().parent();return e.fadeTo(333,.5),r({file:$(this).data("file")},e),!1}),$("#e2-uploaded-images").children().each(function(){var e=$(this).find(".e2-uploaded-image-preview img"),t=e.attr("src"),r=e.attr("alt"),a=e.attr("width"),o=e.attr("height");$(this).remove(),n(t,r,a,o).appendTo($("#e2-uploaded-images")).show()}),new AjaxUpload("e2-upload-button",{action:$("#e2-file-upload-action").attr("href"),autoSubmit:!0,onSubmit:a,onComplete:o}),$("#e2-upload-controls").show(),$(".e2-external-drop-target-body").bind("drop",l),$(".e2-external-drop-target-textarea").bind("drop",l)}})},function(e,t,n){"use strict";var r=n(2),a=function(e){return e&&e.__esModule?e:{default:e}}(r);$("#form-preferences").length&&function(){(0,a.default)(document.getElementById("blog-description")),$("#e2-template-selector").show(),$("#blog-title").bind("input blur cut copy paste keypress",function(){var e=$("#e2-blog-title");e&&e.text(this.value?this.value:$("#e2-blog-title-default").val())}),$("#blog-author").bind("input blur cut copy paste keypress",function(){var e=$("#e2-blog-author");e&&e.text(this.value?this.value:$("#e2-blog-author-default").val())}),$("#notes-per-page").bind("change blur",function(){parseInt(this.value)!==parseInt(this.value)&&(this.value=10),this.value=Math.min(Math.max(this.value,3),100)}),$("#email").bind("input change blur",function(){this.value&&$("#email-notify").attr("checked","checked")}),$(".e2-template-preview").click(function(){var e=$(this);$(".e2-template-preview").attr("class","e2-template-preview"),e.addClass("e2-current-template-preview"),$("#template").val(e.attr("value")),$(".e2-template-preview-link").attr("href",e.data("preview-url"))})}()},function(e,t,n){"use strict";function r(){/^ *$/.test($("#tag").val())||/^ *$/.test($("#urlname").val())?$("#submit-button").attr("disabled","disabled"):$("#submit-button").removeAttr("disabled")}$("#form-tag").length&&($.ajaxSetup({type:"post",timeout:1e4}),$(".required").bind("input blur cut copy paste keypress",r),r())}])});